(function($){"use strict";$.fn.customSelectMenu=function(options){var settings=$.extend({menuClass:'custom-select-menu',openedClass:'opened',selectedClass:'selected',selectionMadeClass:'selection-made'},options);function updateMenu(selection){var customMenuName=selection.parent().attr('data-select-name'),customOptionValue=selection.attr('data-option-value'),customOptionText=selection.text(),hiddenInput=$('input[name="'+customMenuName+'"]');selection.parent().find('.'+settings.selectedClass).removeClass(settings.selectedClass);selection.addClass(settings.selectedClass);hiddenInput.val(customOptionValue);selection.parent().parent().find('label').html(customOptionText+'<i class="icon-arrow-light-down"></i>');if(hiddenInput.val()!==''){selection.parent().parent().find('label').addClass(settings.selectionMadeClass);}else{selection.parent().parent().find('label').removeClass(settings.selectionMadeClass);}
selection.parent().hide();if(selection.parent().css('display')!=='none'){selection.parent().parent().find('label').toggleClass(settings.openedClass);selection.parent().parent().find('i').toggleClass('icon-arrow-light-up');}else{selection.parent().parent().find('label').removeClass(settings.openedClass);selection.parent().parent().find('i').removeClass('icon-arrow-light-up').addClass('icon-arrow-light-down');}}
return this.each(function(){var $this=$(this),selectName=$this.attr('name'),selectId=$this.attr('id'),newHiddenInput,newContainer,newLabel,labelText,newList,newOption,selectedOption,selectedOptionValue,$form=false,$selectables={};if(this.form&&this.form!='undefined'){$form=$(this.form);$this.focus(function(event){var cameFrom=$form.data('lastIn');if(cameFrom!=selectName){newLabel.click();}else{}}).focusout(function(){newContainer.closeIt();});if($form.length>0&&!$form.setFocusout){$form.setFocusout=true;$selectables=$form.find(':input').not('[type="hidden"]').not('[disabled]');$selectables.focusout(function(){$form.data('lastIn',$(this).attr('name'));});$form.selectNextPrev=function(current,isPrev){if($form.length<=0)return;var nextIndex=0;if(current.length===1){var currentIndex=$selectables.index(current);if(!isPrev){if(currentIndex+1<$selectables.length){nextIndex=currentIndex+1;}}else{if(currentIndex>0){nextIndex=currentIndex-1;}}}
$selectables.eq(nextIndex).focus();}}}else{$this.hide();}
newContainer=$('<div class="'+settings.menuClass+'">').attr('tabindex',0);if(selectId){newContainer.attr('id',selectId);$this.removeAttr('id');}
newHiddenInput=$('<input type="hidden" name="'+selectName+'" value="" />');if($this.find(':selected')){selectedOption=$this.find(':selected');selectedOptionValue=selectedOption.attr('value');labelText=selectedOption.text();if(!selectedOptionValue){newLabel=$('<label>'+labelText+'<i class="icon-arrow-light-down"></i></label>');}else{newLabel=$('<label class="'+settings.selectionMadeClass+'">'+labelText+'<i class="icon-arrow-light-down"></i></label>');newHiddenInput.val(selectedOptionValue);}}else{labelText=$this.find(':first').text();newLabel=$('<label>'+labelText+'<i class="icon-arrow-light-down"></i></label>');}
newList=$('<ul data-select-name="'+selectName+'">').hide();$this.after(newContainer.append(newLabel,newList,newHiddenInput));$this.wrap('<div style="position: absolute; z-index: -1; width: 1px; height:1px; overflow:hidden;">');$this.find('option').each(function(){var optionName=$(this).text();var optionValue=$(this).attr("value");var optionClasses=[];if(typeof $(this).attr("class")!=="undefined"){optionClasses.push($(this).attr("class"));}
var optionRel="";if(typeof $(this).attr("rel")!=="undefined"){optionRel=$(this).attr("rel");}
if(optionName===labelText){optionClasses.push(settings.selectedClass);}
if(!optionValue){newOption=$('<li class="'+optionClasses.join(" ")+'" data-option-rel="'+optionRel+'" >'+optionName+'</li>');}else{newOption=$('<li class="'+optionClasses.join(" ")+'" data-option-rel="'+optionRel+'" data-option-value="'+optionValue+'">'+optionName+'</li>');}
newList.append(newOption);})
newContainer.on('click',function(event){var target=$(event.target);if(target.is('label')){newLabel.toggleClass(settings.openedClass);$(this).find('i').toggleClass('icon-arrow-light-down');$(this).find('i').toggleClass('icon-arrow-light-up');newLabel.parent().find('ul').toggle();}
if(target.is('li')){updateMenu(target);}});newContainer.on('keydown',function(e){if(false!==$form&&e.keyCode==9){e.preventDefault();$form.selectNextPrev($this,e.shiftKey);return false;}});newContainer.on('keyup',function(e){if(e.keyCode===38||e.keyCode===40){$(this).find(newLabel).addClass(settings.openedClass);$(this).find('i').toggleClass('icon-arrow-light-up');$(this).find('i').toggleClass('icon-arrow-light-down');$(this).find(newList).show();}
var li=$(this).find('li'),selectedLi=$(this).find('.'+settings.selectedClass),nextLi='',prevLi='';if(e.keyCode===40){selectedLi.removeClass(settings.selectedClass);nextLi=selectedLi.next();if(nextLi.length>0){nextLi.addClass(settings.selectedClass);}else{li.first().addClass(settings.selectedClass);}}
if(e.keyCode===38){selectedLi.removeClass(settings.selectedClass);prevLi=selectedLi.prev();if(prevLi.length>0){prevLi.addClass(settings.selectedClass);}else{li.last().addClass(settings.selectedClass);}}
if(e.keyCode===13){updateMenu($(this).find('.'+settings.selectedClass));}});newContainer.closeIt=function(){if($(this).find(newList).is(':visible')){$(this).find(newLabel).removeClass(settings.openedClass);$(this).find('i').toggleClass('icon-arrow-light-up');$(this).find('i').toggleClass('icon-arrow-light-down');$(this).find(newList).hide();}};newContainer.on('blur',function(){newContainer.closeIt();});$('html').on('keyup',function(e){if(e.keyCode===27){newLabel.removeClass(settings.openedClass);newList.hide();}});$('html').on('mousedown',function(event){var target=$(event.target);if(!target.parents().addBack().is('.'+settings.menuClass+' ul, .'+settings.menuClass+' label')){$('.'+settings.menuClass+' label').removeClass(settings.openedClass);$('.'+settings.menuClass+' label i').removeClass('icon-arrow-light-up');$('.'+settings.menuClass+' label i').addClass('icon-arrow-light-down');$('.'+settings.menuClass+' ul').hide();}});});};})(jQuery);